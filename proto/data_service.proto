syntax = "proto3";

package data_service;
option go_package = "github.com/skni-kod/iot-monitor-backend/internal/proto/data_service";

import "google/protobuf/timestamp.proto";

service DataService{
    rpc StoreReading(StoreReadingRequest) returns (StoreReadingResponse) {}
    rpc QueryReadings(QueryReadingsRequest) returns (QueryReadingsResponse) {}
    rpc StreamReadings(StreamReadingsRequest) returns (stream ReadingUpdate) {}
    rpc GetLatestReadings(LatestReadingsRequest) returns (LatestReadingsResponse) {}
}

message StoreReadingRequest{
    int64 sensor_id = 1;
    float value = 2;
    google.protobuf.Timestamp timestamp = 3;
}

message StoreReadingResponse {}

message QueryReadingsRequest {
    int64 sensor_id = 1;
    google.protobuf.Timestamp start_time = 2;
    google.protobuf.Timestamp end_time = 3;
    string aggregation_interval = 4;
}

message DataPoint {
    google.protobuf.Timestamp time = 1;
    float value = 2;
}

message QueryReadingsResponse {
    repeated DataPoint data_points = 1;
}

message StreamReadingsRequest {
    repeated int64 sensor_ids = 1;
}

message ReadingUpdate {
    int64 sensor_id = 1;
    float value = 2;
    google.protobuf.Timestamp timestamp = 3;
    string sensor_name = 4;
    string location = 5;
    string unit = 6;
}

message LatestReadingsRequest {
    repeated int64 sensor_ids = 1;
}

message LatestReading {
    int64 sensor_id = 1;
    float value = 2;
    google.protobuf.Timestamp timestamp = 3;
}

message LatestReadingsResponse {
    repeated LatestReading readings = 1;
}